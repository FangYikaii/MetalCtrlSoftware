<UserControl x:Class="MetalizationSystem.Views.ProductionProcess"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MetalizationSystem.Views"
             xmlns:domain="clr-namespace:MetalizationSystem.Domain"             
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes" 
             xmlns:viewmodels="clr-namespace:MetalizationSystem.ViewModels" 
             xmlns:locals="clr-namespace:MetalizationSystem" 
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:my="clr-namespace:System.Windows.Forms;assembly=System.Windows.Forms"
             xmlns:extoolkit="http://schemas.xceed.com/wpf/xaml/toolkit"
             d:DataContext="{d:DesignInstance Type=viewmodels:ProductionProcessViewModel}"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="100"/>
            <ColumnDefinition/>
            <ColumnDefinition Width="auto"/>
        </Grid.ColumnDefinitions>
        <GroupBox Header="工站列表" Style="{DynamicResource MaterialDesignCardGroupBox}">
            <ListView  Style="{DynamicResource MaterialDesignFilterChipListBox}" >
                <ListViewItem Content="Start" Tag="Process_Start">
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                            <i:CallMethodAction MethodName="ListViewItem_MouseDown" TargetObject="{Binding}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ListViewItem>
                <ListViewItem Content="超声波" Tag="Process_GlassUltrasonicCleaner">
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                            <i:CallMethodAction MethodName="ListViewItem_MouseDown" TargetObject="{Binding}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ListViewItem>
                <ListViewItem Content="膜活化" Tag="Process_CoatingActivate" >
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                            <i:CallMethodAction MethodName="ListViewItem_MouseDown" TargetObject="{Binding}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ListViewItem>
                <ListViewItem Content="膜烘干" Tag="Process_CoatingBake" >
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                            <i:CallMethodAction MethodName="ListViewItem_MouseDown" TargetObject="{Binding}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ListViewItem>
                <ListViewItem Content="膜镀铜" Tag="Process_CoatingCoppering" >
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                            <i:CallMethodAction MethodName="ListViewItem_MouseDown" TargetObject="{Binding}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ListViewItem>
                <ListViewItem Content="膜改性" Tag="Process_CoatingModified" >
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                            <i:CallMethodAction MethodName="ListViewItem_MouseDown" TargetObject="{Binding}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ListViewItem>
                <ListViewItem Content="膜后浸" Tag="Process_CoatingPostImmersion" >
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                            <i:CallMethodAction MethodName="ListViewItem_MouseDown" TargetObject="{Binding}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ListViewItem>
                <ListViewItem Content="膜预浸" Tag="Process_CoatingPrepreg" >
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                            <i:CallMethodAction MethodName="ListViewItem_MouseDown" TargetObject="{Binding}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ListViewItem>
                <ListViewItem Content="镀膜烘干" Tag="Process_CopperingBake" >
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                            <i:CallMethodAction MethodName="ListViewItem_MouseDown" TargetObject="{Binding}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ListViewItem>
                <ListViewItem Content="玻璃酸洗" Tag="Process_GlassAcidPickling" >
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                            <i:CallMethodAction MethodName="ListViewItem_MouseDown" TargetObject="{Binding}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ListViewItem>
                <ListViewItem Content="玻璃烘干" Tag="Process_GlassBake" >
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                            <i:CallMethodAction MethodName="ListViewItem_MouseDown" TargetObject="{Binding}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ListViewItem>
                <ListViewItem Content="玻璃镀膜" Tag="Process_GlassCoating" >
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                            <i:CallMethodAction MethodName="ListViewItem_MouseDown" TargetObject="{Binding}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ListViewItem>
                <ListViewItem Content="乙醇清洗" Tag="Process_GlassEthanolCleaning" >
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                            <i:CallMethodAction MethodName="ListViewItem_MouseDown" TargetObject="{Binding}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ListViewItem>
                <ListViewItem Content="配液" Tag="Process_LiquidDispensing" >
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                            <i:CallMethodAction MethodName="ListViewItem_MouseDown" TargetObject="{Binding}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </ListViewItem>
            </ListView>
        </GroupBox>

        <ItemsControl x:Name="itControl" Grid.Column="1" AllowDrop="True" ItemsSource="{Binding ProcessList}" 
                      Background="Transparent" Grid.ColumnSpan="2" Margin="0,0,1,0">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Canvas/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="Drop">
                    <i:CallMethodAction MethodName="ItemsControl_Drop" TargetObject="{Binding}"/>
                </i:EventTrigger>
                <i:EventTrigger EventName="MouseRightButtonUp">
                    <i:CallMethodAction MethodName="ItemsControl_MouseRightButtonUp" TargetObject="{Binding}"/>
                </i:EventTrigger>
                <i:EventTrigger EventName="MouseWheel">
                    <i:CallMethodAction MethodName="ItemsControl_MouseWheel" TargetObject="{Binding}"/>
                </i:EventTrigger>
                <i:EventTrigger EventName="MouseLeftButtonDown">
                    <i:CallMethodAction MethodName="ItemsControl_MouseDown" TargetObject="{Binding}"/>
                </i:EventTrigger>
                <i:EventTrigger EventName="MouseLeftButtonUp">
                    <i:CallMethodAction MethodName="ItemsControl_MouseUp" TargetObject="{Binding}"/>
                </i:EventTrigger>
                <i:EventTrigger EventName="MouseMove">
                    <i:CallMethodAction MethodName="ItemsControl_MouseMove" TargetObject="{Binding}"/>
                </i:EventTrigger>
            </i:Interaction.Triggers>
            <ItemsControl.ItemContainerStyle>
                <Style TargetType="ContentPresenter">
                    <Setter Property="Canvas.Left" Value="{Binding X}"/>
                    <Setter Property="Canvas.Top" Value="{Binding Y}"/>
                    <Setter Property="Control.IsTabStop" Value="True"/>
                    <Setter Property="LayoutTransform">
                        <Setter.Value>
                            <ScaleTransform ScaleX="{Binding RelativeSource={RelativeSource AncestorType=UserControl},Path= DataContext.ScaleX}" 
                                            ScaleY="{Binding RelativeSource={RelativeSource AncestorType=UserControl},Path= DataContext.ScaleY}"/>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ItemsControl.ItemContainerStyle>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Grid>
                        <Border Width="{Binding Width}" Height="{Binding Height}" Background="White" CornerRadius="5" x:Name="border"
                                Focusable="True" FocusManager.IsFocusScope="True">
                            <Border.Effect>
                                <DropShadowEffect Color="Gray" ShadowDepth="0" BlurRadius="5" Opacity="0.2"/>
                            </Border.Effect>
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="MouseLeftButtonDown">
                                    <i:CallMethodAction MethodName="Border_MouseLeftButtonDown" TargetObject="{Binding RelativeSource={RelativeSource AncestorType=UserControl},Path= DataContext}"/>
                                </i:EventTrigger>
                                <i:EventTrigger EventName="MouseMove">
                                    <i:CallMethodAction MethodName="Border_MouseMove" TargetObject="{Binding RelativeSource={RelativeSource AncestorType=UserControl},Path= DataContext}"/>
                                </i:EventTrigger>
                                <i:EventTrigger EventName="MouseLeftButtonUp">
                                    <i:CallMethodAction MethodName="Border_MouseLeftButtonUp" TargetObject="{Binding RelativeSource={RelativeSource AncestorType=UserControl},Path= DataContext}"/>
                                </i:EventTrigger>
                                <i:EventTrigger EventName="MouseRightButtonDown">
                                    <i:CallMethodAction MethodName="Border_MouseRightButtonDown" TargetObject="{Binding RelativeSource={RelativeSource AncestorType=UserControl},Path= DataContext}"/>
                                </i:EventTrigger>
                                <i:EventTrigger EventName="MouseRightButtonUp">
                                    <i:CallMethodAction MethodName="Border_MouseRightButtonUp" TargetObject="{Binding RelativeSource={RelativeSource AncestorType=UserControl},Path= DataContext}"/>
                                </i:EventTrigger>
                                <i:EventTrigger EventName="KeyDown">
                                    <i:CallMethodAction MethodName="ItemsControl_KeyDown" TargetObject="{Binding RelativeSource={RelativeSource AncestorType=UserControl},Path= DataContext}"/>
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                            <TextBlock Text="{Binding Name}" VerticalAlignment="Center" HorizontalAlignment="Center">
                                <TextBlock.ContextMenu >
                                    <ContextMenu ItemsSource="{Binding MenuItems}">
                                        <ContextMenu.ItemContainerStyle>
                                            <Style TargetType="MenuItem">
                                                <Setter Property="Command" Value="{Binding DataContext.MenuItemCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"/>
                                                <Setter Property="CommandParameter" Value="{Binding}"/>
                                            </Style>
                                        </ContextMenu.ItemContainerStyle>
                                        <ContextMenu.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding}"/>
                                            </DataTemplate>
                                        </ContextMenu.ItemTemplate>
                                    </ContextMenu>

                                </TextBlock.ContextMenu>                              
                            </TextBlock>
                        </Border>
                        <Line X1="{Binding Sx}" Y1="{Binding Sy}"
                           X2="{Binding X1}" Y2="{Binding Y1}"
                           Stroke="Green"
                           StrokeThickness="2"
                           x:Name="line1" Visibility="Collapsed"/>
                        <Line X1="{Binding X1}" Y1="{Binding Y1}"
    X2="{Binding X2}" Y2="{Binding Y2}"
    Stroke="Green"
    StrokeThickness="2"
    x:Name="line2" Visibility="Collapsed"/>
                        <Line X1="{Binding X2}" Y1="{Binding Y2}"
    X2="{Binding Ex}" Y2="{Binding Ey}"
    Stroke="Green"
    StrokeThickness="2"
    x:Name="line3" Visibility="Collapsed"/>
                        <Line X1="{Binding X3}" Y1="{Binding Y3}"
    X2="{Binding Ex}" Y2="{Binding Ey}"
    Stroke="Green"
    StrokeThickness="2"
    x:Name="line4" Visibility="Collapsed"/>
                        <Line X1="{Binding X4}" Y1="{Binding Y4}"
    X2="{Binding Ex}" Y2="{Binding Ey}"
    Stroke="Green"
    StrokeThickness="2"
    x:Name="line5" Visibility="Collapsed"/>
                    </Grid>
                    <DataTemplate.Triggers>
                        <DataTrigger Binding="{Binding NodeType}" Value="1">
                            <Setter TargetName="border" Property="Visibility" Value="Collapsed"/>
                            <Setter TargetName="line1" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="line2" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="line3" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="line4" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="line5" Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </DataTemplate.Triggers>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
            <ItemsControl.InputBindings>
                <KeyBinding Key="Delete" Command="{Binding KeyDownCommand}"/>
            </ItemsControl.InputBindings>
        </ItemsControl>
        <Grid Grid.Column="2" Grid.ColumnSpan="2">
            <Grid.RowDefinitions>
                <RowDefinition/>
                <RowDefinition Height="55"/>
                <RowDefinition Height="45"/>
            </Grid.RowDefinitions>
            <Expander
    Header="参数">
                <StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <StackPanel Width="20"/>
                        <Label Content="Name"/>
                        <StackPanel Width="10"/>
                        <TextBox Text="{Binding  ProcessName}" VerticalAlignment="Center" HorizontalAlignment="Center" MinWidth="100"/>
                    </StackPanel>
                    <StackPanel Height="5"/>
                    <StackPanel Orientation="Horizontal">
                        <StackPanel Width="20"/>
                        <Label Content="工站"/>
                        <StackPanel Width="10"/>
                        <TextBox Text="{Binding  ProcessStationName}" IsReadOnly="True" VerticalAlignment="Center" HorizontalAlignment="Center" MinWidth="100"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <StackPanel Width="20"/>
                        <Label Content="锁定"/>
                        <StackPanel Width="10"/>
                        <CheckBox IsChecked="{Binding StationLock}" Style="{StaticResource MaterialDesignCheckBox}"/>
                    </StackPanel>
                    <StackPanel>
                        <Button Content="delect" Command="{Binding DelectCommand}"/>
                    </StackPanel>
                    <StackPanel Height="20"/>  
                    <extoolkit:PropertyGrid SelectedObject="{Binding PObj}" Margin="0,45,-0.333,-0.333"></extoolkit:PropertyGrid>
                </StackPanel>


            </Expander>

            <locals:ButtonEx Margin="5,5,5,5" Grid.Row="1" Content="更新" Command="{Binding SaveCommand}" FontFamily="kaiti" FontSize="10" Foreground="#4834d4" OnMouseOverForegroundColor="#4834d4" ImageSize="40"
PathData="M725.333333 0c70.656 0 298.666667 228.096 298.666667 298.666667v597.333333a128 128 0 0 1-128 128H128a128 128 0 0 1-128-128V128a128 128 0 0 1 128-128zM170.666667 85.333333H128a42.666667 42.666667 0 0 0-42.666667 42.666667v768a42.666667 42.666667 0 0 0 42.666667 42.666667h768a42.666667 42.666667 0 0 0 42.666667-42.666667V298.666667c0-10.752-39.850667-56.448-85.333334-102.826667V341.333333a128 128 0 0 1-120.490666 127.786667L725.333333 469.333333H298.666667a128 128 0 0 1-127.786667-120.490666L170.666667 341.333333V85.333333z m554.666666 682.666667a42.666667 42.666667 0 0 1 0 85.333333H298.666667a42.666667 42.666667 0 0 1 0-85.333333h426.666666z m-128-170.666667a42.666667 42.666667 0 0 1 0 85.333334H298.666667a42.666667 42.666667 0 0 1 0-85.333334h298.666666z m128-512H256v256a42.666667 42.666667 0 0 0 37.674667 42.368L298.666667 384h426.666666a42.666667 42.666667 0 0 0 42.368-37.674667L768 341.333333V114.858667c-20.821333-17.92-36.821333-29.525333-42.666667-29.525334z" Grid.RowSpan="2">
            </locals:ButtonEx>
        </Grid>


    </Grid>
</UserControl>
